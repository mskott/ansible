---
- name: Create 3 VMs
  hosts: localhost
  gather_facts: no
  vars:
    machines:
      - vm-kafka-01
      - vm-kafka-02
      - vm-kafka-03
  tasks:
    # Create VMs
    - include_role:
        name: cloud-init-vm
        apply:
          tags: always
      vars:
        vm_name: "{{ item }}"
      loop: "{{ machines }}"
      tags: create
    # Destroy VMs
    - include_role:
        name: delete-vm
        apply:
          tags: always
      vars:
        vm_name: "{{ item }}"
      loop: "{{ machines }}"
      tags: destroy
